<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Two-Layer Membrane Permeance Calculator</title>
    <style>
      body{font-family:Segoe UI,Arial,sans-serif;margin:20px;background:#f5f7fb;color:#222}
      h1{margin-bottom:.3em}
      table{border-collapse:collapse;margin:8px 0;width:100%;max-width:230px;font-size:.9em}
      th,td{border:1px solid #bbb;padding:4px 6px;text-align:center}
      th{background:#e8eef6;font-weight:600}
      input[type=number]{width:90px;padding:4px}
      input[type=text]{width:220px;padding:4px}
      .gas-head{background:#d5e0f2;font-weight:700}
      .note{font-size:.85em;color:#555;margin-top:6px}
      .wrapper{display:flex;flex-wrap:wrap;gap:22px}
      .card{background:#fff;border:1px solid #cdd5e1;border-radius:6px;padding:14px;box-shadow:1px 1px 4px rgba(0,0,0,.05)}
      .btn{background:#1e6be3;border:none;padding:8px 16px;color:#fff;border-radius:4px;cursor:pointer}
      .btn:hover{background:#1653b6}
      .sel-container{display:flex;flex-wrap:wrap;gap:12px;margin-top:12px}
      .sel-card{flex:1 1 230px}

      /* === schematic === */
      .schematic-card{max-width:340px}
      #schematicWrapper{display:flex;align-items:center;gap:14px}
      #memSVG{border:1px solid #777;background:#fff}
      .swatch{width:14px;height:14px;display:inline-block;margin-right:6px;border:1px solid #555;border-radius:2px}
    </style>
  </head>

  <body>
    <h1>Resistance-in-Series Gas Permeance Calculator</h1>

    <div class="wrapper">
      <!-- PARAMETERS ----------------------------------------------->
      <div class="card">
        <h3>Layer names & thickness</h3>
        <p><label><strong>Layer&nbsp;2 name:&nbsp;</strong>
          <input type="text" id="layer2Name" value="Aromatic Polyamide"></label>
        </p>
        <table>
          <tr><th></th><th>PDMS&nbsp;(Layer 1)</th><th id="thickName">Aromatic Polyamide&nbsp;(Layer 2)</th></tr>
          <tr>
            <td class="gas-head">Thickness [µm]</td>
            <td><input type="number" id="t1" value="1" min="0.01" step="0.01"></td>
            <td><input type="number" id="t2" value="1" min="0.01" step="0.01"></td>
          </tr>
        </table>

        <h4>Layer 1 (PDMS) permeabilities (Barrer)</h4>
        <table id="pdmsTable"><tr><th>Gas</th><th>P<sub>1</sub></th></tr></table>

        <h4>Layer 2 permeabilities (Barrer)</h4>
        <table id="inputTable"><tr><th>Gas</th><th>P<sub>2</sub></th></tr></table>

        <button class="btn" onclick="calculate()">Calculate</button>
        <p class="note">
          Blank&nbsp;=&nbsp;impermeable (infinite resistance) for that gas.<br>
          GPU = Permeability / Thickness (Barrer / µm).
        </p>
      </div>

      <!-- RESULTS --------------------------------------------------->
      <div class="card" style="flex:1">
        <h3>Permeance results (GPU)</h3>
        <table id="resultTable"></table>

        <div class="sel-container">
          <div class="sel-card">
            <h4>Neat PDMS</h4><table id="selPDMS"></table>
          </div>
          <div class="sel-card">
            <h4 id="selL2Head">Layer 2</h4><table id="selL2"></table>
          </div>
          <div class="sel-card">
            <h4>Composite<br>(PDMS + Layer 2)</h4><table id="selTotal"></table>
          </div>
        </div>
      </div>

      <!-- SCHEMATIC ------------------------------------------------->
      <div class="card schematic-card">
        <h3>Membrane Schematic</h3>
        <div id="schematicWrapper">
          <!-- svg updated by JS -->
          <svg id="memSVG" width="160" height="110" viewBox="0 0 160 110"></svg>

          <!-- label list -->
          <div id="layerLabels"></div>
        </div>
      </div>
    </div>

    <script>
      /* ---------- Defaults ---------- */
      const defaultPDMS={He:350,H2:650,O2:600,N2:280,CO2:3250,CH4:950};
      const defaultL2  ={He:35 ,H2:29 ,O2:2.4,N2:0.42,CO2:9   ,CH4:0.2};
      const gases=["He","H2","O2","N2","CO2","CH4"];
      const selPairs=[["H2","N2"],["O2","N2"],["CO2","CH4"],["CO2","N2"],
                      ["H2","CH4"],["H2","CO2"],["N2","CH4"],["He","H2"],["H2","O2"]];

      /* ---------- Build input tables ---------- */
      const pdmsTbl=document.getElementById("pdmsTable");
      const l2Tbl=document.getElementById("inputTable");
      gases.forEach(g=>{
        let r1=pdmsTbl.insertRow();
        r1.insertCell().textContent=g;
        let i1=document.createElement("input");
        i1.type="number";i1.id=`P1_${g}`;i1.step="1";i1.min="0";i1.value=defaultPDMS[g];
        r1.insertCell().appendChild(i1);

        let r2=l2Tbl.insertRow();
        r2.insertCell().textContent=g;
        let i2=document.createElement("input");
        i2.type="number";i2.id=`P2_${g}`;i2.step="0.01";i2.min="0";i2.value=defaultL2[g];
        r2.insertCell().appendChild(i2);
      });

      /* ---------- Helpers ---------- */
      const toGPU=(P,l)=>(l?P/l:0);
      const overallGPU=(G1,G2)=>(!G2?G1:1/(1/G1+1/G2));

      /* ---------- Build schematic ---------- */
      const svg=document.getElementById("memSVG");
      const labelsDiv=document.getElementById("layerLabels");
      const colors={layer1:"#90c7e8",layer2:"#f5b93b"};
      let rect1,rect2;  // created once

      function drawSchematic(t1,t2,l1Name,l2Name){
        const total=t1+t2||1;
        const barH=100;                         // total bar height px
        const barW=120;                         // width px
        const padY=5;

        // create rects once
        if(!rect1){
          rect1=document.createElementNS("http://www.w3.org/2000/svg","rect");
          rect2=document.createElementNS("http://www.w3.org/2000/svg","rect");
          svg.appendChild(rect1);svg.appendChild(rect2);
        }
        rect1.setAttribute("x",20);
        rect1.setAttribute("y",padY);
        rect1.setAttribute("width",barW);
        rect1.setAttribute("height",barH*t1/total);
        rect1.setAttribute("fill",colors.layer1);
        rect1.setAttribute("stroke","#555");

        rect2.setAttribute("x",20);
        rect2.setAttribute("y",padY+barH*t1/total);
        rect2.setAttribute("width",barW);
        rect2.setAttribute("height",barH*t2/total);
        rect2.setAttribute("fill",colors.layer2);
        rect2.setAttribute("stroke","#555");

        // labels on the right
        labelsDiv.innerHTML="";
        const makeLabel=(clr,txt)=>{
          let p=document.createElement("p");
          p.style.margin="2px 0";
          p.innerHTML=`<span class="swatch" style="background:${clr}"></span>${txt}`;
          labelsDiv.appendChild(p);
        };
        makeLabel(colors.layer1,l1Name);
        makeLabel(colors.layer2,l2Name);
      }

      /* ---------- Main calculation ---------- */
      function calculate(){
        const layer2Name=(document.getElementById("layer2Name").value||"Layer 2").trim();
        document.getElementById("thickName").textContent=`${layer2Name} (Layer 2)`;
        document.getElementById("selL2Head").textContent=`Neat ${layer2Name}`;

        const t1=parseFloat(document.getElementById("t1").value);
        const t2=parseFloat(document.getElementById("t2").value);

        const G1={},G2={},G={};
        gases.forEach(g=>{
          const P1=parseFloat(document.getElementById(`P1_${g}`).value);
          let   P2=parseFloat(document.getElementById(`P2_${g}`).value);
          if(Number.isNaN(P2))P2=0;

          G1[g]=toGPU(P1,t1);
          G2[g]=toGPU(P2,t2);
          G[g]=overallGPU(G1[g],G2[g]);
        });

        /* ----- Permeance table ----- */
        const rt=document.getElementById("resultTable");rt.innerHTML="";
        let hdr=rt.insertRow();
        ["Gas","GPU₁ (PDMS)",`GPU₂ (${layer2Name})`,"GPU_total"].forEach(h=>{
          const th=document.createElement("th");th.textContent=h;hdr.appendChild(th);
        });
        gases.forEach(g=>{
          let row=rt.insertRow();
          row.insertCell().textContent=g;
          row.insertCell().textContent=G1[g].toFixed(2);
          row.insertCell().textContent=G2[g]?G2[g].toFixed(2):"—";
          row.insertCell().textContent=G[g].toFixed(2);
        });

        /* ----- Selectivity tables ----- */
        buildSel("selPDMS",G1);
        buildSel("selL2",G2,true);   // true = hide “—” when zero
        buildSel("selTotal",G);

        /* ----- Schematic ----- */
        drawSchematic(t1,t2,"PDMS",layer2Name);
      }

      function buildSel(tableID,gpu,hideZero=false){
        const t=document.getElementById(tableID);t.innerHTML="";
        let h=t.insertRow();
        ["A/B","α (A/B)"].forEach(tx=>{
          const th=document.createElement("th");th.textContent=tx;h.appendChild(th);
        });
        selPairs.forEach(([A,B])=>{
          let r=t.insertRow();
          r.insertCell().textContent=`${A}/${B}`;
          const val=gpu[B]? (gpu[A]/gpu[B]).toFixed(2) : hideZero?"—":"∞";
          r.insertCell().textContent=val;
        });
      }

      /* initial render */
      calculate();
    </script>
  </body>
</html>
